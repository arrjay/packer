{
  "variables": {
    "system": "quo"
  },
  "builders": [
    {
      "type": "null",
      "ssh_host": "127.0.0.1",
      "ssh_username": "root",
      "ssh_port": "8222",
      "ssh_password": "linux",
      "ssh_timeout": "20m"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": "zypper --non-interactive up -y"
    },
    {
      "execute_command":	"chmod +x {{ .Path }}; sudo env {{ .Vars }} {{ .Path }}",
      "type":			"shell",
      "scripts": [
        "{{ user `system` }}-files/consul.sh"
      ]
    },
    {
      "type": "shell",
      "inline": "mkdir -p /var/lib/px-firstboot && mkdir -p /usr/libexec/px-firstboot"
    },
    {
      "type": "file",
      "source": "shared/px-firstboot/px-firstboot.service",
      "destination": "/etc/systemd/system/px-firstboot.service"
    },
    {
      "type": "file",
      "source": "shared/px-firstboot/startup.sh",
      "destination": "/usr/libexec/px-firstboot/startup"
    },
    {
      "type": "file",
      "source": "shared/opensuse/firstboot-dracut.sh",
      "destination": "/usr/libexec/px-firstboot/dracut-update.sh"
    },
    {
      "type": "shell",
      "inline": "cd /etc/systemd/system/multi-user.target.wants && ln -s /etc/systemd/system/px-firstboot.service"
    },
    {
      "type": "shell",
      "inline": "zypper --non-interactive in -y at && service atd start && echo 'poweroff' | at now + 1 minutes"
    }
  ]
}
